Age8_summary
# CASES TO FOLLOW INTERACTION TERMS
D8_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
# RUN ADONIS
# formula as () LHS (disc required!) ~ RHS (your metadata), data = metadata, perms)
D1_adonis_run   <- adonis2(D1_dist  ~ OA*Temp*Salinity, data=D1_meta_distance, perms = permutations)
D4_adonis_run   <- adonis2(D4_dist  ~ OA*Temp*Salinity, data=D4_meta_distance, perms = permutations)
D8_adonis_run   <- adonis2(D8_dist  ~ OA*Temp*Salinity, data=D8_meta_distance, perms = permutations)
D11_adonis_run  <- adonis2(D11_dist ~ OA*Temp*Salinity, data=D11_meta_distance, perms = permutations)
D15_adonis_run  <- adonis2(D15_dist ~ OA*Temp*Salinity, data=D15_meta_distance, perms = permutations)
D1_adonis_run
# REQUIRED TO HAVE LHS DEP VAR AS ITS OWN MATRIX
Mean_D1_Length <- as.data.frame( # all 24 tanks
Age1_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
Mean_D4_Length <- as.data.frame( # all 24 tanks
Age4_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
Mean_D8_Length <- as.data.frame( # all 24 tanks
Age8_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
Mean_D11_Length <- as.data.frame(# N = 21 tanks remaining
Age11_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
Mean_D15_Length <- as.data.frame( # N = 17 tanks remaining
Age15_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
Mean_D19_Length <- as.data.frame( # only 5 tanks - Do not run PERMANOVA
Age19_raw_length %>%
dplyr::select(length_um,OA,Temp,Salinity,random_fact) %>%
dplyr::group_by(OA,Temp,Salinity,random_fact) %>%
dplyr::rename(sample.id = random_fact) %>%
dplyr::summarise(length_um=mean(length_um))
)
# METADATA
D1_metadata  <- Mean_D1_Length %>% dplyr::select(-length_um)
D4_metadata  <- Mean_D4_Length %>% dplyr::select(-length_um)
D8_metadata  <- Mean_D8_Length %>% dplyr::select(-length_um)
D11_metadata <- Mean_D11_Length %>% dplyr::select(-length_um)
D15_metadata <- Mean_D15_Length %>% dplyr::select(-length_um)
D19_metadata <- Mean_D19_Length %>% dplyr::select(-length_um)
# CALL JUST THE LENGTH DATA TO COMPUTE DISTANCE MATRIX
D1_length         <- Mean_D1_Length[, 'length_um', drop = FALSE]
D1_distance_euc   <- vegdist(D1_length, "euclidean")
D4_length         <- Mean_D4_Length[, 'length_um', drop = FALSE]
D4_distance_euc   <- vegdist(D4_length, "euclidean")
D8_length         <- Mean_D8_Length[, 'length_um', drop = FALSE]
D8_distance_euc   <- vegdist(D8_length, "euclidean")
D11_length         <- Mean_D11_Length[, 'length_um', drop = FALSE]
D11_distance_euc   <- vegdist(D11_length, "euclidean")
D15_length         <- Mean_D15_Length[, 'length_um', drop = FALSE]
D15_distance_euc   <- vegdist(D15_length, "euclidean")
D19_length         <- Mean_D19_Length[, 'length_um', drop = FALSE]
D19_distance_euc   <- vegdist(D19_length, "euclidean")
# CREATE SQUARE MATRIX ASSIGN ROW NAMES AND COLUMN NAMES AS THE GROUP VAR
D1_distance_mtx           <- as.matrix(D1_distance_euc)
rownames(D1_distance_mtx) <- Mean_D1_Length$sample.id
colnames(D1_distance_mtx) <- Mean_D1_Length$sample.id
D4_distance_mtx           <- as.matrix(D4_distance_euc)
rownames(D4_distance_mtx) <- Mean_D4_Length$sample.id
colnames(D4_distance_mtx) <- Mean_D4_Length$sample.id
D8_distance_mtx           <- as.matrix(D8_distance_euc)
rownames(D8_distance_mtx) <- Mean_D8_Length$sample.id
colnames(D8_distance_mtx) <- Mean_D8_Length$sample.id
D11_distance_mtx           <- as.matrix(D11_distance_euc)
rownames(D11_distance_mtx) <- Mean_D11_Length$sample.id
colnames(D11_distance_mtx) <- Mean_D11_Length$sample.id
D15_distance_mtx           <- as.matrix(D15_distance_euc)
rownames(D15_distance_mtx) <- Mean_D15_Length$sample.id
colnames(D15_distance_mtx) <- Mean_D15_Length$sample.id
# Then...
# CONVERT THE ROWNAME TO FIRST COLUMN, CONVERT TO DATAFRAME TO DO SO
D1_distance  <- tibble::rownames_to_column(as.data.frame(D1_distance_mtx), "sample.id")
D4_distance  <- tibble::rownames_to_column(as.data.frame(D4_distance_mtx), "sample.id")
D8_distance  <- tibble::rownames_to_column(as.data.frame(D8_distance_mtx), "sample.id")
D11_distance <- tibble::rownames_to_column(as.data.frame(D11_distance_mtx), "sample.id")
D15_distance <- tibble::rownames_to_column(as.data.frame(D15_distance_mtx), "sample.id")
# NOW USE INNER_JOIN TO MERGE THE METADATA
D1_meta_distance  <- inner_join(D1_distance,  D1_metadata, by = "sample.id")
D4_meta_distance  <- inner_join(D4_distance,  D4_metadata, by = "sample.id")
D8_meta_distance  <- inner_join(D8_distance,  D8_metadata, by = "sample.id")
D11_meta_distance <- inner_join(D11_distance, D11_metadata, by = "sample.id")
D15_meta_distance <- inner_join(D15_distance, D15_metadata, by = "sample.id")
# get the dist matrix
D1_dist  <- D1_meta_distance  %>% dplyr::select(all_of(D1_meta_distance$sample.id)) %>% as.dist()
D4_dist  <- D4_meta_distance  %>% dplyr::select(all_of(D4_meta_distance$sample.id)) %>% as.dist()
D8_dist  <- D8_meta_distance  %>% dplyr::select(all_of(D8_meta_distance$sample.id)) %>% as.dist()
D11_dist <- D11_meta_distance %>% dplyr::select(all_of(D11_meta_distance$sample.id)) %>% as.dist()
D15_dist <- D15_meta_distance %>% dplyr::select(all_of(D15_meta_distance$sample.id)) %>% as.dist()
# RUN ADONIS
# formula as () LHS (disc required!) ~ RHS (your metadata), data = metadata, perms)
D1_adonis_run   <- adonis2(D1_dist  ~ OA*Temp*Salinity, data=D1_meta_distance, perms = permutations)
D4_adonis_run   <- adonis2(D4_dist  ~ OA*Temp*Salinity, data=D4_meta_distance, perms = permutations)
D8_adonis_run   <- adonis2(D8_dist  ~ OA*Temp*Salinity, data=D8_meta_distance, perms = permutations)
D11_adonis_run  <- adonis2(D11_dist ~ OA*Temp*Salinity, data=D11_meta_distance, perms = permutations)
D15_adonis_run  <- adonis2(D15_dist ~ OA*Temp*Salinity, data=D15_meta_distance, perms = permutations)
write.csv(as.data.frame(D1_adonis_run), "Output/Length/stat_tables/D1_PERMANOVA.csv")# write
write.csv(as.data.frame(D4_adonis_run), "Output/Length/stat_tables/D4_PERMANOVA.csv")# write
write.csv(as.data.frame(D8_adonis_run), "Output/Length/stat_tables/D8_PERMANOVA.csv")# write
write.csv(as.data.frame(D11_adonis_run), "Output/Length/stat_tables/D11_PERMANOVA.csv")# write
write.csv(as.data.frame(D15_adonis_run), "Output/Length/stat_tables/D15_PERMANOVA.csv")# write
# CASES TO FOLLOW INTERACTION TERMS
D1_adonis_run # we see main effects of OA, Temp and Salinity and interaction OA:Salinity
# CASES TO FOLLOW INTERACTION TERMS
D4_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
# CASES TO FOLLOW INTERACTION TERMS
D4_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
# pCO2 main effect
age4_pCO2_meanSE <- Age4_raw_length %>%
dplyr::select(OA,length_um) %>%
dplyr::group_by(OA) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age4_pCO2_meanSE
# High	76.70462	9.541234	0.7254066
# Low	84.77301	9.675344	0.6393647
((84.77301-76.70462)/84.77301)*100 # 5.2 % larger under low pCO2
# temperature main effect
age4_Temp_meanSE <- Age4_raw_length %>%
dplyr::select(Temp,length_um) %>%
dplyr::group_by(Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age4_Temp_meanSE
# temperature main effect
age4_Salinity_meanSE <- Age4_raw_length %>%
dplyr::select(Salinity,length_um) %>%
dplyr::group_by(Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age4_Salinity_meanSE
# High	83.46450	10.16818	0.7154307
# Low	79.11545	10.20752	0.7217809
((83.46450-79.11545)/83.46450)*100 # 5.2 % larger under low pCO2
# temperature main effect
age4_Salinity_meanSE <- Age4_raw_length %>%
dplyr::select(Salinity,length_um) %>%
dplyr::group_by(Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age4_Salinity_meanSE
# pCO2 main effect
age8_pCO2_meanSE <- Age8_raw_length %>%
dplyr::select(OA,length_um) %>%
dplyr::group_by(OA) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age8_pCO2_meanSE
age8_Salinity_meanSE
age8_pCO2_meanSE
# High	97.11573	16.23607	0.5794904
# Low	115.94102	27.09128	0.9040478
((115.94102-97.11573)/115.94102)*100 # 9.51764 % larger under low pCO2
# temperature main effect
age8_Salinity_meanSE <- Age8_raw_length %>%
dplyr::select(Salinity,length_um) %>%
dplyr::group_by(Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age8_Salinity_meanSE
# High	114.35630	26.52823	0.8548602
# Low	97.53579	17.48773	0.6517291
((114.35630-97.53579)/114.35630)*100 # 5.210658 % larger under low pCO2
# pCO2 and temp interaction term
age4_OATemp_meanSE <- Age4_raw_length %>%
dplyr::mutate(OA_Temp = paste0(OA, "_x_", Temp)) %>%
dplyr::select(OA_Temp,length_um) %>%
dplyr::group_by(OA_Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age4_OATemp_meanSE
# High_x_High	74.93013	9.712118	1.0996808
# High_x_Low	78.16158	9.195128	0.9434002
# Low_x_High	88.33520	10.721876	1.0721876
# Low_x_Low	82.01163	7.761141	0.6833304
((88.33520-74.93013)/88.33520)*100 # 5.210658 % larger under Low_x_High relative to High_x_High
# RUN ADONIS FOR EACH PAIR
D4_adonis_HH_LL   <- adonis2(D4_HH_LL_dist  ~ OA_Temp, data=D4_HH_LL_metadata, perms = permutations) # nope
# CREATE AN OA_SALINITY COLUMN
D4_meta_distance  <- D4_meta_distance %>% dplyr::mutate(OA_Temp = paste0(OA,' x ',Temp))
# TRUNCATE THE DATA FOR EACH PAIR BASED ON OA AND SALINITY, WITH UNIQUE TITLE
# Note: two two-factor variables == 6 possible pairs
# METADATA (IV)
D4_HH_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'Low x Low'))
D4_HH_LH_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'Low x High'))
D4_HL_LH_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x Low', 'Low x High'))
D4_HL_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x Low', 'Low x Low'))
D4_LH_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('Low x High', 'Low x Low'))
# DISTANCE (DV)
D4_HH_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LL_metadata$sample.id) %>%
dplyr::select(D1_HH_LL_metadata$sample.id) %>%
as.dist()
D4_HL_LH_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HL_LH_metadata$sample.id) %>%
dplyr::select(D1_HL_LH_metadata$sample.id) %>%
as.dist()
# CASES TO FOLLOW INTERACTION TERMS
D4_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
# CREATE AN OA_SALINITY COLUMN
D4_meta_distance  <- D4_meta_distance %>% dplyr::mutate(OA_Temp = paste0(OA,' x ',Temp))
# TRUNCATE THE DATA FOR EACH PAIR BASED ON OA AND SALINITY, WITH UNIQUE TITLE
# Note: two two-factor variables == 6 possible pairs
# METADATA (IV)
D4_HH_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'Low x Low'))
D4_HH_LH_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'Low x High'))
D4_HH_HL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'High x Low'))
D4_HL_LH_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x Low', 'Low x High'))
D4_HL_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x Low', 'Low x Low'))
D4_LH_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('Low x High', 'Low x Low'))
# DISTANCE (DV)
D4_HH_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LL_metadata$sample.id) %>%
dplyr::select(D1_HH_LL_metadata$sample.id) %>%
as.dist()
D4_HH_LH_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LH_metadata$sample.id) %>%
dplyr::select(D1_HH_LH_metadata$sample.id) %>%
as.dist()
# TRUNCATE THE DATA FOR EACH PAIR BASED ON OA AND SALINITY, WITH UNIQUE TITLE
# Note: two two-factor variables == 6 possible pairs
# METADATA (IV)
D4_HH_LL_metadata <- D4_meta_distance %>% dplyr::filter(OA_Temp %in% c('High x High', 'Low x Low'))
D4_HH_LL_metadata
# DISTANCE (DV)
D4_HH_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LL_metadata$sample.id) %>%
dplyr::select(D1_HH_LL_metadata$sample.id) %>%
as.dist()
D4_meta_distance
# DISTANCE (DV)
D4_HH_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LL_metadata$sample.id) %>%
dplyr::select(D4_HH_LL_metadata$sample.id) %>%
as.dist()
D4_HH_LH_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_LH_metadata$sample.id) %>%
dplyr::select(D4_HH_LH_metadata$sample.id) %>%
as.dist()
D4_HH_HL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HH_HL_metadata$sample.id) %>%
dplyr::select(D4_HH_HL_metadata$sample.id) %>%
as.dist()
D4_HL_LH_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HL_LH_metadata$sample.id) %>%
dplyr::select(D4_HL_LH_metadata$sample.id) %>%
as.dist()
D4_HL_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_HL_LL_metadata$sample.id) %>%
dplyr::select(D4_HL_LL_metadata$sample.id) %>%
as.dist()
D4_LH_LL_dist     <- D4_meta_distance %>%
dplyr::filter(sample.id %in% D4_LH_LL_metadata$sample.id) %>%
dplyr::select(D4_LH_LL_metadata$sample.id) %>%
as.dist()
# RUN ADONIS FOR EACH PAIR
D4_adonis_HH_LL   <- adonis2(D4_HH_LL_dist  ~ OA_Temp, data=D4_HH_LL_metadata, perms = permutations) # nope
D4_adonis_HH_LL
D4_adonis_HH_LH   <- adonis2(D4_HH_LH_dist  ~ OA_Temp, data=D4_HH_LH_metadata, perms = permutations) # yup
D4_adonis_HH_HL   <- adonis2(D4_HH_HL_dist  ~ OA_Temp, data=D4_HH_HL_metadata, perms = permutations) # nope
D4_adonis_HL_LH   <- adonis2(D4_HL_LH_dist  ~ OA_Temp, data=D4_HL_LH_metadata, perms = permutations) # yup
D4_adonis_HL_LL   <- adonis2(D4_HL_LL_dist  ~ OA_Temp, data=D4_HL_LL_metadata, perms = permutations) # yup
D4_adonis_LH_LL   <- adonis2(D4_LH_LL_dist  ~ OA_Temp, data=D4_LH_LL_metadata, perms = permutations) # yup
D4_adonis_HH_LH
D4_adonis_HH_HL
D4_adonis_HL_LH
D4_adonis_HL_LL
D4_adonis_LH_LL   <- adonis2(D4_LH_LL_dist  ~ OA_Temp, data=D4_LH_LL_metadata, perms = permutations) # yup
D4_adonis_LH_LL
D4_adonis_HH_LH
D4_adonis_HH_HL
D4_adonis_HL_LL
D4_adonis_HH_LL
D4_adonis_HH_LH
D4_adonis_HH_LL
D4_adonis_HH_HL
D4_adonis_HL_LL
# pCO2 and temp interaction term
age8_OATemp_meanSE <- Age8_raw_length %>%
dplyr::mutate(OA_Temp = paste0(OA, "_x_", Temp)) %>%
dplyr::select(OA_Temp,length_um) %>%
dplyr::group_by(OA_Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age8_OATemp_meanSE
# High_x_High	96.64262	18.08435	0.9338719
# High_x_Low	97.54845	14.34770	0.7085822
# Low_x_High	124.69074	31.04733	1.4245492
# Low_x_Low	106.11569	17.15803	0.8342519
((124.69074-96.64262)/124.69074)*100 # 15.17523 % larger under Low_x_High relative to High_x_High
((88.33520-78.16158)/88.33520)*100 # 15.17523 % smaller under High_x_Low relative to Low_x_High
((124.69074-97.54845)/124.69074)*100 # 22.49415 % smaller under High_x_Low relative to Low_x_High
# CASES TO FOLLOW INTERACTION TERMS
D11_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
# CASES TO FOLLOW INTERACTION TERMS
D15_adonis_run # we see main effects of OA, Temp and interaction OA:Temp
Age11_summary <- Age11_raw_length %>% dplyr::select(OA, Temp, Salinity,length_um) %>%
dplyr::group_by(OA, Temp, Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()), n = n()))
Age11_summary <- Age11_raw_length %>% dplyr::select(OA, Temp, Salinity,length_um) %>%
dplyr::group_by(OA, Temp, Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()), n = n()))
mean(Age11_summary$n) # mean = 210.375
sd(Age11_summary$n)# SD = 40.13882
Age15_summary <- Age15_raw_length %>% dplyr::select(OA, Temp, Salinity,length_um) %>%
dplyr::group_by(OA, Temp, Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n()), n = n()))
mean(Age15_summary$n) # mean = 55.875
sd(Age15_summary$n)# SD = 29.1422
mean(Age15_summary$n) # mean = 55.875
Age15_summary
# temperature main effect
age11_Temp_meanSE <- Age11_raw_length %>%
dplyr::select(Salinity,length_um) %>%
dplyr::group_by(Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age11_Temp_meanSE
# High	144.4325	50.91659	2.910708
# Low	118.0298	30.66179	2.582189
((144.4325-118.0298)/144.4325)*100 # 5.210658 % larger under high salinity
# temperature main effect
age11_Temp_meanSE <- Age11_raw_length %>%
dplyr::select(Temp,length_um) %>%
dplyr::group_by(Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age11_Temp_meanSE
# High	160.0100	49.96401	3.192084
# Low	107.1093	18.74936	1.319201
((160.0100-107.1093)/160.0100)*100 # 5.210658 % larger under high salinity
# temp x salinity interaction term
age4_TempSalinity_meanSE <- Age4_raw_length %>%
dplyr::mutate(Temp_Salinity = paste0(Temp, "_x_", Salinity)) %>%
dplyr::select(Temp_Salinity,length_um) %>%
dplyr::group_by(OA_Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
# temp x salinity interaction term
age11_TempSalinity_meanSE <- Age11_raw_length %>%
dplyr::mutate(Temp_Salinity = paste0(Temp, "_x_", Salinity)) %>%
dplyr::select(Temp_Salinity,length_um) %>%
dplyr::group_by(OA_Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
# temp x salinity interaction term
age11_TempSalinity_meanSE <- Age11_raw_length %>%
dplyr::mutate(Temp_Salinity = paste0(Temp, "_x_", Salinity)) %>%
dplyr::select(Temp_Salinity,length_um) %>%
dplyr::group_by(Temp_Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age11_TempSalinity_meanSE
# High_x_High	170.8969	48.90280	3.624917
# High_x_Low	128.5592	38.59962	4.863095
# Low_x_High	105.5895	18.76234	1.684908
# Low_x_Low	109.5253	18.59285	2.105226
((170.8969-105.5895)/170.8969)*100 # 33.06087 % larger under high temperature
# High_x_High	170.8969	48.90280	3.624917
# High_x_Low	128.5592	38.59962	4.863095
# Low_x_High	105.5895	18.76234	1.684908
# Low_x_Low	109.5253	18.59285	2.105226
((170.8969-105.5895)/170.8969)*100 # 33.06087 % smaller under High_x_Low relative to Low_x_High
((170.8969-128.5592)/170.8969)*100 # 38.2145 % smaller under Low_x_High relative to High_x_High
# plot with letters - dotted line = low temperature, red = low salinity
Age15_ShellLength_Boxplot <- ggplot(data=Age15_raw_length,
aes(x=fct_relevel(OA, c("Low", "High")),
y=length_um,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype= Temp)) +
geom_boxplot() +
stat_summary(fun.y="mean",position = position_dodge2(width = 0.75)) +
labs(title="Age = 8 days", x ="pCO2 level", y = "Larvae size (Î¼m)") +
theme_classic() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
axis.text=element_text(size=12),
legend.position="none")
Age15_ShellLength_Boxplot
# salinity main effect
age15_Salinity_meanSE <- Age15_raw_length %>%
dplyr::select(Salinity,length_um) %>%
dplyr::group_by(Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age15_Salinity_meanSE
# High	221.8048	85.03881	5.69462
# Low	189.7829	70.65317	6.83030
((221.8048-189.7829)/221.8048)*100 # 18.2803 % larger under high salinity
# temperature main effect
age15_Temp_meanSE <- Age15_raw_length %>%
dplyr::select(Temp,length_um) %>%
dplyr::group_by(Temp) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age15_Temp_meanSE
# High	255.0615	65.11517	4.400075
# Low	125.3223	20.10262	1.908056
((255.0615-125.3223)/255.0615)*100 # 33.06087 % larger under high temperature
# temp x salinity interaction term
age15_TempSalinity_meanSE <- Age15_raw_length %>%
dplyr::mutate(Temp_Salinity = paste0(Temp, "_x_", Salinity)) %>%
dplyr::select(Temp_Salinity,length_um) %>%
dplyr::group_by(Temp_Salinity) %>%
dplyr::summarise_each(funs(mean,sd,se=sd(.)/sqrt(n())))
age15_TempSalinity_meanSE
# High_x_High	270.1614	58.32591	4.762290
# High_x_Low	222.2357	67.39709	8.113656
# Low_x_High	122.4419	19.38224	2.268520
# Low_x_Low	130.8555	20.55663	3.334725
((270.1614-122.4419)/270.1614)*100 # 38.2145 % smaller under Low_x_High relative to High_x_High
((270.1614-222.2357)/270.1614)*100 # 24.77383 % smaller under High_x_Low relative to High_x_High
# LOAD PACKAGES
library(emmeans)
library(car)
library(ggpubr)
library(rcompanion)
library(emmeans)
library(forcats)
library(dplyr)
library(vegan)
library(tidyverse)
# SET WORKING DIRECTORY
knitr::opts_knit$set(root.dir = "C:/Users/samjg/Documents/Github_repositories/Cvirginica_multistressor/RAnalysis/")
Resp.Master  <- read.csv(file="Output/Respiration/RespirationMaster.csv", header=T) # reference for the respirometry data - contains the 'Chamber_Tank' for each sensor channel (whether an animal or a blank)
# model effect of treatment on resp rate 20210430
Resp_APRIL <- Resp.Master %>%
dplyr::filter(Date %in% '4/30/2021') # %>%
Resp_APRIL # view the data
# View(Resp_APRIL)
# Three way ANOVA
LMmod.APRIL   <- aov(lm(resp_ng_L_indiv_hr~Temp*pCO2*Salinity,data=Resp_APRIL))
shapiro.test(residuals(LMmod.APRIL)) # 0.009733 - non normal
leveneTest(LMmod.APRIL) # 0.3256 - variance okay
summary(LMmod.APRIL)
# LOG transform
LMmod.APRIL_T   <- aov(lm(log(resp_ng_L_indiv_hr)~pCO2*Temp*Salinity,data=Resp_APRIL))
shapiro.test(residuals(LMmod.APRIL_T)) # 0.6472
leveneTest(LMmod.APRIL_T) # 0.6339
summary(LMmod.APRIL_T)
# PERMANOVA - Resp_APRIL mltvariate anova
RR_metadata           <- Resp_APRIL %>% dplyr::select(Temp,pCO2,Salinity,Chamber_tank) %>% dplyr::rename(sample.id = Chamber_tank) # all but the DV - only IVs
RR_metadata$sample.id <- as.character(RR_metadata$sample.id)
RR_data               <- Resp_APRIL[, 'resp_ng_L_indiv_hr', drop = FALSE]
RR_distance_euc       <- vegdist(RR_data, "euclidean")
RR_distance_mtx           <- as.matrix(RR_distance_euc)
rownames(RR_distance_mtx) <- Resp_APRIL$Chamber_tank
colnames(RR_distance_mtx) <- Resp_APRIL$Chamber_tank
RR_distance               <- tibble::rownames_to_column(as.data.frame(RR_distance_mtx), "sample.id")
RR_meta_distance          <- inner_join(RR_metadata,RR_distance, by = "sample.id")
RR_dist                   <- RR_meta_distance  %>% dplyr::select(all_of(RR_meta_distance$sample.id)) %>% as.dist()
adonis_run                <- adonis2(RR_dist  ~ pCO2*Temp*Salinity, data=RR_meta_distance, perms = 1000)
adonis_run
# use emmeans to get the letters for the tukey posthoc test
posthoc<-emmeans(LMmod.APRIL_T, pairwise~Temp:pCO2, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# Summary table to report mean se data and percent differences
# main effect of temperature
Resp_APRIL %>%
group_by(Temp) %>%
summarise_each(funs(mean, sd, se=sd(.)/sqrt(n())),resp_ng_L_indiv_hr)
((1.5151186-0.6335014)/1.5151186)*100 # 58.188
# post hoc interaction term
Resp_APRIL %>%
dplyr::mutate(Temp_pCO2 = paste(Temp,pCO2, sep = '')) %>%
group_by(Temp_pCO2) %>%
summarise_each(funs(mean, sd, se=sd(.)/sqrt(n())),resp_ng_L_indiv_hr)
APRIL_all <- Resp_APRIL %>%
dplyr::mutate(Temp_pCO2 = paste(Temp,pCO2, sep = '')) %>%
dplyr::mutate(full.treatment = (paste(Temp, pCO2, Salinity,sep=''))) %>%
dplyr::mutate(full.treatment = fct_relevel(full.treatment,
"LHL", "LHH", "HHL",'HHH',
"LLL", "LLH", "HLL", 'HLH')) %>%
ggplot(aes(fct_relevel(Temp_pCO2, c("LH", "HH", "LL", "HL")), # x
resp_ng_L_indiv_hr,
fill = factor(Salinity)) ) +
scale_fill_manual(values=c("white", "grey10")) +
geom_boxplot(size=0.2, alpha=0.1) +
geom_point(aes(shape=Salinity),
size = 2,
position = position_jitterdodge(jitter.width = 0.5)) +
labs(title = "C virginica, 24 hr larvae",
y = expression(Respiration~rate~"("~ng~L^{-1}~O[2]%.%indiv^{-1}%.% hr^{-1}~")"),
x = "Temp_pCO2_Salinity") +
scale_y_continuous(expand = c(0, 0), limits = c(0, NA)) +
annotate("text", x=4, y=0.8, label = "c (1.3 medArag)", size  =3) +
annotate("text", x=2, y=3, label = "ab (0.54 medArag)", size =3) +
annotate("text", x=1, y=3, label = "b (0.45 medArag)", size  =3) +
annotate("text", x=3, y=5, label = "a (1.03 medArag)", size  =3) +
#annotate("rect", xmin = 0, xmax = 4.5, ymin = 0, ymax = 6.5,alpha = .2) +
theme_classic()
APRIL_all
# PERMANOVA - Resp_APRIL mltvariate anova
RR_metadata           <- Resp_APRIL %>% dplyr::select(Temp,pCO2,Salinity,Chamber_tank) %>% dplyr::rename(sample.id = Chamber_tank) # all but the DV - only IVs
RR_metadata$sample.id <- as.character(RR_metadata$sample.id)
RR_data               <- Resp_APRIL[, 'resp_ng_L_indiv_hr', drop = FALSE]
RR_distance_euc       <- vegdist(RR_data, "euclidean")
RR_distance_mtx           <- as.matrix(RR_distance_euc)
rownames(RR_distance_mtx) <- Resp_APRIL$Chamber_tank
colnames(RR_distance_mtx) <- Resp_APRIL$Chamber_tank
RR_distance               <- tibble::rownames_to_column(as.data.frame(RR_distance_mtx), "sample.id")
RR_meta_distance          <- inner_join(RR_metadata,RR_distance, by = "sample.id")
RR_dist                   <- RR_meta_distance  %>% dplyr::select(all_of(RR_meta_distance$sample.id)) %>% as.dist()
RR_dist
adonis_run                <- adonis2(RR_dist  ~ pCO2*Temp*Salinity, data=RR_meta_distance, perms = 1000)
adonis_run
