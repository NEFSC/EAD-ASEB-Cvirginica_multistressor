size = 1,
color = 'white') +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
facet_grid(vars(Temp),
vars(fct_relevel(OA_Sal, c("HL", "LL", "HH", "LH"))))
setwd("C:/Users/samjg/Documents/Github_repositories/Cvirginica_multistressor/RAnalysis")
pdf("Output/Survival/plots/Survival_hatch_facetted.pdf", width=11, height=5)
print(Heatplot_Day1)
dev.off()
print(Heatplot_Day1)
Survival_means <- Survival_dat %>%
dplyr::filter(Day >1) %>%
#na.omit() %>%
dplyr::group_by(Day, OA, Salinity, Temp) %>%
dplyr::summarise(mean_survival = mean(Survival),
n           = n(),
sd_survival   = sd(Survival),
se_survival   = sd_survival/(sqrt(n)))
Survival_to_set_means <- as.data.frame(Survival_means %>%
filter(Day %in% 15) %>%
dplyr::select(c(Day, OA, Salinity, Temp, mean_survival)) %>%
dplyr::group_by(OA, Salinity, Temp)  %>%
tidyr::spread(Day, mean_survival) %>%  # new columns titled 1 and 15 for he Age and with values for the
# length data grouped by treatment
dplyr::mutate(Survival_to_set = (`15`) *100 ) %>%
dplyr::select(!`15`))
Survival_means_MASTER <- merge(Survival_means, Survival_to_set_means, by=c('OA', 'Salinity', 'Temp')) %>%
dplyr::mutate(OA_Sal = paste(substr(OA,1,1),
substr(Salinity,1,1),
sep = ''))
Heatplot <- Survival_means_MASTER %>%
ggplot(aes(x = Day,
y = mean_survival)) +
geom_rect(aes(fill = Survival_to_set),
xmin = -Inf,
xmax = Inf,
ymin = -Inf,
ymax = Inf,
alpha = 0.3) +
geom_point(color = 'black') +
geom_line(aes(x = Day,
y = mean_survival)) +
geom_errorbar(aes(ymin = mean_survival - se_survival,
ymax = mean_survival + se_survival),
width = 0.5,
position= "dodge2") +
geom_smooth(method = "lm",
se = FALSE,
size = 1,
color = 'white') +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
facet_grid(vars(Temp),
vars(fct_relevel(OA_Sal, c("HL", "LL", "HH", "LH")))) +
geom_text(size = 2,
aes(x = 12,
y = 0.8,
label = paste0(round(Survival_to_set,2),"% survival to set"))) +
scale_fill_gradient(low = "orange",
high = "forestgreen",
aesthetics = "fill")
print(Heatplot)
Heatplot_day15 <- Survival_means_MASTER %>%
dplyr::filter(Day %in% 15) %>%
dplyr::mutate(Day = as.factor(Day)) %>%
ggplot(aes(x = Day,
y = mean_survival)) +
geom_point(color = 'black') +
geom_line(aes(x = Day,
y = mean_survival)) +
geom_errorbar(aes(ymin = mean_survival - se_survival,
ymax = mean_survival + se_survival),
width = 0.5,
position= "dodge2") +
geom_smooth(method = "lm",
se = FALSE,
size = 1,
color = 'white') +
theme_bw() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank()) +
facet_grid(vars(Temp),
vars(fct_relevel(OA_Sal, c("HL", "LL", "HH", "LH"))))
print(Heatplot_day15)
age_4<- Survival_dat%>%
filter(Day=="4") %>%
arrange(Survival) %>%
mutate(Survival = ifelse(Survival == last(Survival), 0.75, Survival)) # ID #12 was 0.46 -  whereas survival on day 4 was 0.75 - this is an artifact of increased numbers? I changed to 0.75 to reflect no losses between days 4 and 4
Age4_Survival_lme_mod <- lme(Survival~OA*Salinity*Temp,random=~1|random_fact,data=age_4)
pander(anova(Age4_Survival_lme_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   |  16   |  188.3  | 2.878e-10 |
# |        **OA**        |   1   |  16   |  1.342  |  0.2638   |
# |     **Salinity**     |   1   |  16   |  9.182  | 0.007963  | *
# |       **Temp**       |   1   |  16   |  3.637  |  0.07464  |
# |   **OA:Salinity**    |   1   |  16   | 0.5783  |   0.458   |
# |     **OA:Temp**      |   1   |  16   |  1.396  |  0.2546   |
# |  **Salinity:Temp**   |   1   |  16   | 0.06036 |   0.809   |
# | **OA:Salinity:Temp** |   1   |  16   | 0.2301  |   0.638   |
leveneTest(residuals(Age4_Survival_lme_mod) ~ age_4$Temp*age_4$OA*age_4$Salinity) # 0.712 pass
boxplot(residuals(Age4_Survival_lme_mod) ~ age_4$Temp*age_4$OA*age_4$Salinity) # visual of residuals grouped
qqnorm(resid(Age4_Survival_lme_mod)) # check for normality of residuals - looks okay
# run mod (lm model)
Age4_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_4)
pander(anova(Age4_Survival_lm_mod), style='rmarkdown') # anova table of lm
shapiro.test(residuals(Age4_Survival_lm_mod)) # 0.2763 pass
age_18<- Survival_dat%>%
filter(Day=="18") %>%
arrange(Survival) %>%
mutate(Survival = ifelse(Survival == last(Survival), 0.75, Survival)) # ID #12 was 0.156 -  whereas survival on day 15 was 0.75 - this is an artifact of increased numbers? I changed to 0.75 to reflect no losses between days 15 and 15
age_18
Age18_Survival_lme_mod <- lme(Survival~OA*Salinity*Temp,random=~1|random_fact,data=age_18)
pander(anova(Age18_Survival_lme_mod), style='rmarkdown') # anova table of lm
# run mod (lm model)
Age18_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_18)
pander(anova(Age18_Survival_lm_mod), style='rmarkdown') # anova table of lm
shapiro.test(residuals(Age18_Survival_lm_mod)) # 6.513e-05 pass
qqnorm(resid(Age18_Survival_lm_mod)) # check for normality of residuals - looks okay
# run mod (lm model)
Age18_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod)) # 0.0008217
hist(resid(Age18_Survival_lm_mod))
Age18_Survival_lm_mod_T <- lm(log(Survival)~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) # 3.337e-06
Age18_Survival_lm_mod_T <- lm(log(Survival)~OA*Salinity*Temp,data=age_18)
Age18_Survival_lm_mod_T <- lm(log(Survival)~OA*Salinity*Temp,data=age_18)
age_18
Age18_Survival_lm_mod <- lm(sqrt(Survival+1)~OA*Salinity*Temp,data=age_18)
Age18_Survival_lm_mod_T <- lm(log(Survival+1)~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) # 3.337e-06
age_18
View(age_18)
(age_18 %>% filter(Temperature %in% 'Low'))$Survival)
mean((age_18 %>% filter(Temperature %in% 'Low'))$Survival)*100
age_18 %>% filter(Temperature %in% 'Low')
age_18
(age_18 %>% filter(Temp %in% 'Low')
age_18 %>% filter(Temp %in% 'Low')
age_18 %>% dplyr::filter(Temp %in% 'Low')
(age_18 %>% dplyr::filter(Temp %in% 'Low')$Survival)
age_18 %>% dplyr::filter(Temp %in% 'Low')$Survival
age_18 %>% dplyr::filter(Temp %in% 'Low')
age_18 %>% dplyr::filter(Temp %in% 'Low')$Survival
(age_18 %>% dplyr::filter(Temp %in% 'Low')$Survival
(age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival
(age_18 %>% dplyr::filter(Temp %in% 'Low'))
(age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival
(age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival
mean( (age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' | Sal %in% 'Low'))$Survival*100)
age_18
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' | Salinity %in% 'Low'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low' | Salinity %in% 'Low')
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low')
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low' & OA %in% 'High'))$Survival*100)
mean'((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low' & OA %in% 'High'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High')
age_18 %>% dplyr::filter(Temp %in% 'High' & Salinity %in% 'Low' & OA %in% 'High')
mean((age_18 %>% dplyr::filter(Temp %in% 'High' & Salinity %in% 'Low' & OA %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'High' & Salinity %in% 'Low' & OA %in% 'High'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low' & OA %in% 'High'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High')
age_18 %>% dplyr::filter(Temp %in% 'High' & Salinity %in% 'Low' & OA %in% 'High')
age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity %in% 'Low'& OA %in% 'High')
mean((age_18 %>% dplyr::filter(Temp %in% 'Low' & Salinity))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'High'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low')
age_18 %>% dplyr::filter(Temp %in% 'High')
age_18 %>% dplyr::filter(Temp %in% 'High')
age_18 %>% dplyr::filter(Temp %in% 'Low')
setwd("C:/Users/samjg/Documents/Github_repositories/Cvirginica_multistressor/RAnalysis")
# survival data
Survival_dat <- read.csv("Data/Survival/Survival_master.csv", header = T) %>%
dplyr::mutate(random_fact = paste( substr(Temp,1,1),
substr(OA,1,1),
substr(Salinity,1,1), '_', Replicate, sep = ''))
# head(Survival_dat) # view first few lines
View(Survival_dat)
# extract the experiment data with corresponding sample Ids from the averaged data master file...
Exp_data <-  Survival_dat %>%
filter(Day %in% 1) %>%
dplyr::select(c('Temp','OA','Salinity','Replicate','Id.', 'pH', 'AR')) %>%
dplyr::rename(Sample.ID = Id., Aragonite_saturation = AR)
age_18<- Survival_dat%>%
filter(Day=="18") %>%
arrange(Survival)
mean((age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'Low'))$Survival*100)
mean((age_18 %>% dplyr::filter(Temp %in% 'High'))$Survival*100)
sd((age_18 %>% dplyr::filter(Temp %in% 'High'))$Survival*100)
age_18 %>% dplyr::filter(Temp %in% 'Low')
# run mod (lm model)
Age18_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_18)
pander(anova(Age15_Survival_lm_mod), style='rmarkdown') # anova table of lm
# run mod (lm model)
Age18_Survival_lm_mod <- lm((Survival)~OA*Salinity*Temp,data=age_18)
pander(anova(Age15_Survival_lm_mod), style='rmarkdown') # anova table of lm
pander(anova(Age18_Survival_lm_mod), style='rmarkdown') # anova table of lm
shapiro.test(residuals(Age18_Survival_lm_mod)) # 6.513e-05 pass
hist(resid(Age18_Survival_lm_mod))
Age18_Survival_lm_mod_T <- lm(log(Survival)~OA*Salinity*Temp,data=age_18)
Age18_Survival_lm_mod_T <- lm(log(Survival)~OA*Salinity*Temp,data=age_18)
Age18_Survival_lm_mod_T <- lm(log(Survival+1)~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) #  0.000557
Age18_Survival_lm_mod_T <- lm(sqrt(Survival+1)~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) #  0.000557
Age18_Survival_lm_mod_T <- lm(asin(sqrt(Survival+1))~OA*Salinity*Temp,data=age_18)
Age18_Survival_lm_mod_T <- lm(asin(sqrt(Survival))~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) #  0.000557
leveneTest(residuals(Age18_Survival_lm_mod_T) ~ age_18$Temp*age_18$OA*age_18$Salinity) # 0.4224 pass
boxplot(residuals(Age18_Survival_lm_mod_T) ~ age_18$Temp*age_18$OA*age_18$Salinity) # visual of residuals grouped
qqnorm(resid(Age18_Survival_lm_mod_T)) # check for normality of residuals - looks okay
pander(anova(Age18_Survival_lm_mod_T), style='rmarkdown') # anova table of lm
age_15<- Survival_dat%>%
filter(Day=="15") %>%
arrange(Survival) %>%
mutate(Survival = ifelse(Survival == last(Survival), 0.75, Survival)) # ID #12 was 0.156 -  whereas survival on day 15 was 0.75 - this is an artifact of increased numbers? I changed to 0.75 to reflect no losses between days 15 and 15
age_15<- Survival_dat%>%
filter(Day=="15") %>%
arrange(Survival)
# run mod (lm model)
Age15_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_15)
shapiro.test(residuals(Age15_Survival_lm_mod)) # 6.513e-05 pass
leveneTest(residuals(Age15_Survival_lm_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # 0.4224 pass
pander(anova(Age15_Survival_lm_mod), style='rmarkdown') # anova table of lm
boxplot(residuals(Age15_Survival_lm_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # visual of residuals grouped
posthoc<-emmeans(Age15_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# plot the data  ----------------------------------------------------------------------------------------------------- #
Age15_Survival_Boxplot_2 <- age_15 %>%
dplyr::group_by(OA,Salinity, Temp) %>%
dplyr::summarise(mean_surv = mean(Survival),
n         = n(),
sd_surv   = sd(Survival),
se_surv   = sd_surv/(sqrt(n))) %>%
ggplot(aes(x=fct_relevel(OA, c("Low", "High")),
y=mean_surv,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype = Temp)) +
geom_point(aes (fill = fct_relevel(Salinity, c("Low", "High")), shape = Temp), position = "dodge2") +
geom_errorbar(aes(ymin = mean_surv - se_surv, ymax = mean_surv + se_surv), width = 0.5, position= "dodge2") +
theme_classic() +
#ylim(0,0.75) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title="Age = 15 days", x ="pCO2 level", y = "Survival")+
theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
theme(axis.text=element_text(size=12))
print(Age15_Survival_Boxplot_2)
##Here Low Salinity treatments are in Blue
Age15_Survival_Boxplot <-ggplot(data=age_15, aes(x=fct_relevel(OA, c("Low", "High")),
y=Survival,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype = Temp)) +
geom_boxplot() +
theme_classic() +
geom_jitter(position = position_dodge2(width = 0.75))+
ylim(0,0.75) +
stat_summary(fun.y="mean",position = position_dodge2(width = 0.75)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title="Age = 15 days (all data)",
x ="pCO2 level",
y = expression(Respiration~rate~"("~ng~L^{-1}~O[2]%.%indiv^{-1}%.% hr^{-1}~")")) +
theme(axis.title.y = element_text(size = rel(1.3), angle =90),
axis.title.x = element_text(size = rel(1.3), angle = 0)) +
theme(axis.text=element_text(size=12))
print(Age15_Survival_Boxplot)
shapiro.test(residuals(Age15_Survival_lm_mod)) # 0.481 pass
leveneTest(residuals(Age15_Survival_lm_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # 0.4767 pass
boxplot(residuals(Age15_Survival_lm_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # visual of residuals grouped
qqnorm(resid(Age15_Survival_lm_mod)) # check for normality of residuals - looks okay
posthoc<-emmeans(Age15_Survival_lm_mod, pairwise~OA, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# Salinity emmean     SE df lower.CL upper.CL .group
# Low       0.134 0.0391 16   0.0507    0.217  a
# High      0.374 0.0391 16   0.2908    0.457   b
(0.374-0.134/0.374)*100
0.374-0.134/0.374
0.374-0.134
0.374-0.134/0.374
(0.374-0.134/0.374)*100
# Salinity emmean     SE df lower.CL upper.CL .group
# Low       0.134 0.0391 16   0.0507    0.217  a
# High      0.374 0.0391 16   0.2908    0.457   b
((0.374-0.134)/0.374))*100
# Salinity emmean     SE df lower.CL upper.CL .group
# Low       0.134 0.0391 16   0.0507    0.217  a
# High      0.374 0.0391 16   0.2908    0.457   b
((0.374-0.134)/0.374)*100
# OA   emmean     SE df lower.CL upper.CL .group
# High  0.187 0.0391 16    0.104    0.270  a
# Low   0.321 0.0391 16    0.238    0.404   b
((0.321-0.187)/0.321)*100
age_11<- Survival_dat%>%
filter(Day=="11") %>%
arrange(Survival) %>%
mutate(Survival = ifelse(Survival == last(Survival), 0.75, Survival)) # ID #12 was 0.116 -  whereas survival on day 11 was 0.75 - this is an artifact of increased numbers? I changed to 0.75 to reflect no losses between days 11 and 11
# run mod (lm model)
Age11_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_11)
pander(anova(Age11_Survival_lm_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | Df |  Sum Sq  | Mean Sq  | F value |  Pr(>F)  |
# |:--------------------:|:--:|:--------:|:--------:|:-------:|:--------:|
# |        **OA**        | 1  | 0.02429  | 0.02429  |  1.068  |  0.3167  |
# |     **Salinity**     | 1  |  0.2103  |  0.2103  |  9.248  | 0.007782 |
# |       **Temp**       | 1  | 0.02436  | 0.02436  |  1.072  |  0.316   |
# |   **OA:Salinity**    | 1  | 0.001717 | 0.001717 | 0.07552 |  0.787   |
# |     **OA:Temp**      | 1  | 0.008341 | 0.008341 | 0.3669  |  0.5532  |
# |  **Salinity:Temp**   | 1  | 0.008777 | 0.008777 |  0.386  |  0.5431  |
# | **OA:Salinity:Temp** | 1  | 0.01486  | 0.01486  | 0.6535  |  0.4307  |
# |    **Residuals**     | 16 |  0.3638  | 0.02274  |   NA    |    NA    |
library(stats)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.008833 pass
leveneTest(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # 0.2159 pass
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.008833 pass
Age11_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_11)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.008833 pass
Age11_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_11)
leveneTest(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # 0.2159 pass
boxplot(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # visual of residuals grouped
pander(anova(Age11_Survival_lm_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | Df |  Sum Sq  | Mean Sq  | F value |  Pr(>F)  |
# |:--------------------:|:--:|:--------:|:--------:|:-------:|:--------:|
# |        **OA**        | 1  | 0.05677  | 0.05677  |  1.914  |  0.1855  |
# |     **Salinity**     | 1  |  0.3857  |  0.3857  |  13.01  | 0.002367 |
# |       **Temp**       | 1  | 0.01109  | 0.01109  | 0.3739  |  0.5495  |
# |   **OA:Salinity**    | 1  | 0.05075  | 0.05075  |  1.711  |  0.2093  |
# |     **OA:Temp**      | 1  | 0.002309 | 0.002309 | 0.07784 |  0.7838  |
# |  **Salinity:Temp**   | 1  | 0.001894 | 0.001894 | 0.06387 |  0.8037  |
# | **OA:Salinity:Temp** | 1  | 0.006706 | 0.006706 | 0.2261  |  0.6409  |
# |    **Residuals**     | 16 |  0.4745  | 0.02966  |   NA    |    NA    |
boxplot(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # visual of residuals grouped
qqnorm(resid(Age11_Survival_lm_mod)) # check for normality of residuals - looks okay
posthoc<-emmeans(Age11_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# Salinity emmean     SE df lower.CL upper.CL .group
# Low       0.229 0.0497 16    0.123    0.334  a
# High      0.482 0.0497 16    0.377    0.588   b
((0.482-0.229)/0.482)*100
age_11<- Survival_dat%>%
filter(Day=="11") %>%
arrange(Survival)
Age11_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_11)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.4941 pass
# run mod (lm model)
Age11_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_11)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.4941 pass
# run mod (lm model)
Age11_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_11)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.4941 pass
leveneTest(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # 0.5766 pass
pander(anova(Age11_Survival_lm_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | Df |  Sum Sq  | Mean Sq  | F value |  Pr(>F)  |
# |:--------------------:|:--:|:--------:|:--------:|:-------:|:--------:|
# |        **OA**        | 1  | 0.01205  | 0.01205  |  0.837  |  0.3739  |
# |     **Salinity**     | 1  |  0.1701  |  0.1701  |  11.82  | 0.003379 |
# |       **Temp**       | 1  |  0.0121  |  0.0121  | 0.8404  |  0.3729  |
# |   **OA:Salinity**    | 1  | 0.007663 | 0.007663 | 0.5324  |  0.4762  |
# |     **OA:Temp**      | 1  | 0.002046 | 0.002046 | 0.1421  |  0.7111  |
# |  **Salinity:Temp**   | 1  | 0.002264 | 0.002264 | 0.1573  |  0.6969  |
# | **OA:Salinity:Temp** | 1  | 0.005744 | 0.005744 | 0.3991  |  0.5365  |
# |    **Residuals**     | 16 |  0.2303  | 0.01439  |   NA    |    NA    |
boxplot(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # visual of residuals grouped
qqnorm(resid(Age11_Survival_lm_mod)) # check for normality of residuals - looks okay
posthoc<-emmeans(Age11_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
age_11<- Survival_dat%>%
filter(Day=="11") %>%
arrange(Survival)
# run mod (lm model)
Age11_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_11)
shapiro.test(residuals(Age11_Survival_lm_mod)) # 0.405 pass
leveneTest(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # 0.5766 pass
pander(anova(Age11_Survival_lm_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | Df |  Sum Sq  | Mean Sq  | F value |  Pr(>F)  |
# |:--------------------:|:--:|:--------:|:--------:|:-------:|:--------:|
# |        **OA**        | 1  | 0.01205  | 0.01205  |  0.837  |  0.3739  |
# |     **Salinity**     | 1  |  0.1701  |  0.1701  |  11.82  | 0.003379 |
# |       **Temp**       | 1  |  0.0121  |  0.0121  | 0.8404  |  0.3729  |
# |   **OA:Salinity**    | 1  | 0.007663 | 0.007663 | 0.5324  |  0.4762  |
# |     **OA:Temp**      | 1  | 0.002046 | 0.002046 | 0.1421  |  0.7111  |
# |  **Salinity:Temp**   | 1  | 0.002264 | 0.002264 | 0.1573  |  0.6969  |
# | **OA:Salinity:Temp** | 1  | 0.005744 | 0.005744 | 0.3991  |  0.5365  |
# |    **Residuals**     | 16 |  0.2303  | 0.01439  |   NA    |    NA    |
boxplot(residuals(Age11_Survival_lm_mod) ~ age_11$Temp*age_11$OA*age_11$Salinity) # visual of residuals grouped
qqnorm(resid(Age11_Survival_lm_mod)) # check for normality of residuals - looks okay
posthoc<-emmeans(Age11_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
age_11
posthoc<-emmeans(Age11_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
((0.2425-0.0741)/0.2425)*100
# plot the data  ----------------------------------------------------------------------------------------------------- #
Age11_Survival_Boxplot_2 <- age_11 %>%
dplyr::group_by(OA,Salinity, Temp) %>%
dplyr::summarise(mean_surv = mean(Survival),
n         = n(),
sd_surv   = sd(Survival),
se_surv   = sd_surv/(sqrt(n))) %>%
ggplot(aes(x=fct_relevel(OA, c("Low", "High")),
y=mean_surv,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype = Temp)) +
geom_point(aes (fill = fct_relevel(Salinity, c("Low", "High")), shape = Temp), position = "dodge2") +
geom_errorbar(aes(ymin = mean_surv - se_surv, ymax = mean_surv + se_surv), width = 0.5, position= "dodge2") +
theme_classic() +
#ylim(0,0.75) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title="Age = 11 days", x ="pCO2 level", y = "Survival")+
theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
theme(axis.text=element_text(size=12))
print(Age11_Survival_Boxplot_2)
age_15<- Survival_dat%>%
filter(Day=="15") %>%
arrange(Survival)
Age15_Survival_lme_mod <- lme(Survival~OA*Salinity*Temp,random=~1|random_fact,data=age_15)
pander(anova(Age15_Survival_lme_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | numDF | denDF | F-value | p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:--------:|
# |   **(Intercept)**    |   1   |  16   |  13.17  | 0.002259 |
# |        **OA**        |   1   |  16   |  2.751  |  0.1166  |
# |     **Salinity**     |   1   |  16   |  6.994  | 0.01766  |
# |       **Temp**       |   1   |  16   | 0.4106  |  0.5307  |
# |   **OA:Salinity**    |   1   |  16   | 0.8238  |  0.3775  |
# |     **OA:Temp**      |   1   |  16   | 0.0958  |  0.7609  |
# |  **Salinity:Temp**   |   1   |  16   | 0.05448 |  0.8184  |
# | **OA:Salinity:Temp** |   1   |  16   | 0.5834  |  0.4561  |
leveneTest(residuals(Age15_Survival_lme_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # 0.4224 pass
# run mod (lm model)
Age15_Survival_lm_mod <- lm(sqrt(Survival)~OA*Salinity*Temp,data=age_15)
shapiro.test(residuals(Age15_Survival_lm_mod)) # 0.481 pass
leveneTest(residuals(Age15_Survival_lm_mod) ~ age_15$Temp*age_15$OA*age_15$Salinity) # 0.4767 pass
pander(anova(Age15_Survival_lm_mod), style='rmarkdown') # anova table of lm
posthoc<-emmeans(Age15_Survival_lm_mod, pairwise~Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# Salinity emmean     SE df lower.CL upper.CL .group
# Low       0.134 0.0391 16   0.0507    0.217  a
# High      0.374 0.0391 16   0.2908    0.457   b
((0.374-0.134)/0.374)*100
# plot the data  ----------------------------------------------------------------------------------------------------- #
Age15_Survival_Boxplot_2 <- age_15 %>%
dplyr::group_by(OA,Salinity, Temp) %>%
dplyr::summarise(mean_surv = mean(Survival),
n         = n(),
sd_surv   = sd(Survival),
se_surv   = sd_surv/(sqrt(n))) %>%
ggplot(aes(x=fct_relevel(OA, c("Low", "High")),
y=mean_surv,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype = Temp)) +
geom_point(aes (fill = fct_relevel(Salinity, c("Low", "High")), shape = Temp), position = "dodge2") +
geom_errorbar(aes(ymin = mean_surv - se_surv, ymax = mean_surv + se_surv), width = 0.5, position= "dodge2") +
theme_classic() +
#ylim(0,0.75) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title="Age = 15 days", x ="pCO2 level", y = "Survival")+
theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
theme(axis.text=element_text(size=12))
print(Age15_Survival_Boxplot_2)
posthoc<-emmeans(Age15_Survival_lm_mod, pairwise~OA, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
# OA   emmean     SE df lower.CL upper.CL .group
# High  0.187 0.0391 16    0.104    0.270  a
# Low   0.321 0.0391 16    0.238    0.404   b
((0.321-0.187)/0.321)*100
age_18<- Survival_dat%>%
filter(Day=="18") %>%
arrange(Survival)
# run mod (lm model)
Age18_Survival_lm_mod <- lm((Survival)~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod)) #  0.000557
hist(resid(Age18_Survival_lm_mod))
Age18_Survival_lm_mod_T <- lm(asin(sqrt(Survival))~OA*Salinity*Temp,data=age_18)
shapiro.test(residuals(Age18_Survival_lm_mod_T)) #  0.07886
leveneTest(residuals(Age18_Survival_lm_mod_T) ~ age_18$Temp*age_18$OA*age_18$Salinity) # 0.2879 pass
pander(anova(Age18_Survival_lm_mod_T), style='rmarkdown') # anova table of lm
posthoc<-emmeans(Age18_Survival_lm_mod_T, pairwise~OA*Temp*Salinity, adjust="tukey")
multcomp::cld(posthoc$emmeans,alpha = 0.5, Letters = letters)
##Here Low Salinity treatments are in Blue
Age18_Survival_Boxplot <-ggplot(data=age_18, aes(x=fct_relevel(OA, c("Low", "High")),
y=Survival,
colour=fct_relevel(Salinity, c("Low", "High")),
linetype = Temp)) +
geom_boxplot() +
theme_classic() +
geom_jitter(position = position_dodge2(width = 0.75))+
ylim(0,0.75) +
stat_summary(fun.y="mean",position = position_dodge2(width = 0.75)) +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title="Age = 15 days (all data)",
x ="pCO2 level",
y = expression(Respiration~rate~"("~ng~L^{-1}~O[2]%.%indiv^{-1}%.% hr^{-1}~")")) +
theme(axis.title.y = element_text(size = rel(1.3), angle =90),
axis.title.x = element_text(size = rel(1.3), angle = 0)) +
theme(axis.text=element_text(size=12))
Age18_Survival_Boxplot
