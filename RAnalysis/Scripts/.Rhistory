# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |  588  | 105297  |     0     |
# |     **OA**      |   1   |   8   |  58.24  | 6.121e-05 |
# |  **Salinity**   |   1   |   8   |  105.2  | 7.024e-06 |
# | **OA:Salinity** |   1   |   8   |  1.258  |  0.2945   |
leveneTest(residuals(Age1Length_lme_mod_hightemp) ~Age1_raw_length_hightemp$OA*Age1_raw_length_hightemp$Salinity) # 0.4058 PASS
Levenboxplot(residuals(Age1Length_lme_mod_hightemp) ~ Age1_raw_length_hightemp$OA*Age1_raw_length_hightemp$Salinity) # visual of residuals grouped
qqnorm(resid(Age1Length_lme_mod_hightemp)) # check for normality of residuals
# run model (LM)
Age1Length_lm_mod_hightemp <- lm(length_um~OA*Salinity,data=Age1_raw_length_hightemp) # notice temp is removed...
pander(anova(Age1Length_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:---------------:|:---:|:------:|:-------:|:-------:|:---------:|
# |     **OA**      |  1  |  1765  |  1765   |  155.6  | 6.78e-32  |
# |  **Salinity**   |  1  |  3188  |  3188   |  281.1  | 5.767e-52 |
# | **OA:Salinity** |  1  | 38.13  |  38.13  |  3.362  |  0.06722  |
# |  **Residuals**  | 596 |  6760  |  11.34  |   NA    |    NA     |
shapiro.test(residuals(Age1Length_lm_mod_hightemp)) # 0.2515 pass
pander(anova(Age1Length_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
Age8Length_lme_mod <- lme(length_um~OA*Salinity*Temp,random=~1|random_fact,data=Age8_raw_length)
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   | 1050  |  2433   |     0     |
# |        **OA**        |   1   |  15   |  17.5   | 0.0008002 |
# |     **Salinity**     |   1   |  15   |  16.61  | 0.0009943 |
# |       **Temp**       |   1   |  15   |  5.035  |  0.04035  |
# |   **OA:Salinity**    |   1   |  15   | 0.9695  |  0.3404   |
# |     **OA:Temp**      |   1   |  15   |  7.119  |  0.01754  |
# |  **Salinity:Temp**   |   1   |  15   |  4.766  |  0.04532  |
# | **OA:Salinity:Temp** |   1   |  15   |  4.322  |  0.05518  |
leveneTest(residuals(Age8Length_lme_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   | 1050  |  2433   |     0     |
# |        **OA**        |   1   |  15   |  17.5   | 0.0008002 |
# |     **Salinity**     |   1   |  15   |  16.61  | 0.0009943 |
# |       **Temp**       |   1   |  15   |  5.035  |  0.04035  |
# |   **OA:Salinity**    |   1   |  15   | 0.9695  |  0.3404   |
# |     **OA:Temp**      |   1   |  15   |  7.119  |  0.01754  |
# |  **Salinity:Temp**   |   1   |  15   |  4.766  |  0.04532  |
# | **OA:Salinity:Temp** |   1   |  15   |  4.322  |  0.05518  |
leveneTest(residuals(Age8Length_lme_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
boxplot(residuals(Age8Length_lme_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # visual of residuals grouped
qqnorm(resid(Age8Length_lme_mod)) # check for normality of residuals - looks okay
#  run model (lm)
Age8Length_lm_mod <- lm(length_um~OA*Salinity*Temp,data=Age8_raw_length)
pander(anova(Age8Length_lm_mod), style='rmarkdown') # anova table of lmr
# |        &nbsp;        |  Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:--------------------:|:----:|:------:|:-------:|:-------:|:---------:|
# |        **OA**        |  1   | 87009  |  87009  |  269.5  | 3.636e-54 |
# |     **Salinity**     |  1   | 76531  |  76531  |  237.1  | 1.894e-48 |
# |       **Temp**       |  1   | 25675  |  25675  |  79.53  | 2.022e-18 |
# |   **OA:Salinity**    |  1   |  3917  |  3917   |  12.13  | 0.0005157 |
# |     **OA:Temp**      |  1   | 37837  |  37837  |  117.2  | 5.505e-26 |
# |  **Salinity:Temp**   |  1   | 27137  |  27137  |  84.06  | 2.408e-19 |
# | **OA:Salinity:Temp** |  1   | 21019  |  21019  |  65.11  | 1.898e-15 |
# |    **Residuals**     | 1065 | 343803 |  322.8  |   NA    |    NA     |
shapiro.test(residuals(Age8Length_lm_mod)) # 1.397e-14
leveneTest(residuals(Age8Length_lm_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
pander(anova(Age8Length_lm_mod), style='rmarkdown') # anova table of lmr
#data
Age8_raw_length_hightemp <- Age8_raw_length %>% dplyr::filter(!Temp %in% 'Low')
# run model ( LME model)
Age8Length_lme_mod_hightemp <- lme(length_um~OA*Salinity,random=~1|random_fact,data=Age8_raw_length_hightemp) # notice temp is removed...
pander(anova(Age8Length_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
Age8Length_lme_mod <- lme(length_um~OA*Salinity*Temp,random=~1|random_fact,data=Age8_raw_length)
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   | 1050  |  2433   |     0     |
# |        **OA**        |   1   |  15   |  17.5   | 0.0008002 |
# |     **Salinity**     |   1   |  15   |  16.61  | 0.0009943 |
# |       **Temp**       |   1   |  15   |  5.035  |  0.04035  |
# |   **OA:Salinity**    |   1   |  15   | 0.9695  |  0.3404   |
# |     **OA:Temp**      |   1   |  15   |  7.119  |  0.01754  |
# |  **Salinity:Temp**   |   1   |  15   |  4.766  |  0.04532  |
# | **OA:Salinity:Temp** |   1   |  15   |  4.322  |  0.05518  |
leveneTest(residuals(Age8Length_lme_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   | 1176  | 151157  |     0     |
# |        **OA**        |   1   |  16   |  108.4  | 1.56e-08  | *
# |       **Temp**       |   1   |  16   |  18.6   | 0.0005359 | *
# |     **Salinity**     |   1   |  16   |  120.4  | 7.426e-09 | *
# |     **OA:Temp**      |   1   |  16   |  1.363  |  0.2601   |
# |   **OA:Salinity**    |   1   |  16   |  5.876  |  0.02756  | *
# |  **Temp:Salinity**   |   1   |  16   |  2.105  |  0.1661   |
# | **OA:Temp:Salinity** |   1   |  16   |  1.135  |  0.3026   |
leveneTest(residuals(Age1Length_lme_mod) ~ Age1_raw_length$Temp*Age1_raw_length$OA*Age1_raw_length$Salinity) # 0.2716 PASS
pander(anova(Age1Length_lme_mod), style='rmarkdown') # anova table of lmer
qqnorm(resid(Age1Length_lme_mod)) # check for normality of residuals
# run model (lm mod)
Age1Length_lm_mod <- lm(length_um~OA*Temp*Salinity,data=Age1_raw_length)
pander(anova(Age1Length_lm_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        |  Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:--------------------:|:----:|:------:|:-------:|:-------:|:---------:|
# |        **OA**        |  1   |  4478  |  4478   |  419.8  | 3.562e-80 | *
# |       **Temp**       |  1   | 768.3  |  768.3  |  72.03  | 6.209e-17 | *
# |     **Salinity**     |  1   |  4974  |  4974   |  466.3  | 1.503e-87 | *
# |     **OA:Temp**      |  1   |  56.3  |  56.3   |  5.278  |  0.02177  | *
# |   **OA:Salinity**    |  1   | 242.7  |  242.7  |  22.75  | 2.069e-06 | *
# |  **Temp:Salinity**   |  1   | 86.96  |  86.96  |  8.153  | 0.004374  | *
# | **OA:Temp:Salinity** |  1   | 46.86  |  46.86  |  4.393  |  0.03629  | *
# |    **Residuals**     | 1192 | 12714  |  10.67  |   NA    |    NA     |
shapiro.test(residuals(Age1Length_lm_mod)) # 0.002907 no pass
leveneTest(residuals(Age1Length_lm_mod) ~ Age1_raw_length$Temp*Age1_raw_length$OA*Age1_raw_length$Salinity) # 0.2793 PASS
pander(anova(Age1Length_lm_mod), style='rmarkdown') # anova table of lmer
#data
Age1_raw_length_hightemp <- Age1_raw_length %>% dplyr::filter(!Temp %in% 'Low')
# run model (LME)
Age1Length_lme_mod_hightemp <- lme(length_um~OA*Salinity,random=~1|random_fact,data=Age1_raw_length_hightemp) # notice temp is removed...
pander(anova(Age1Length_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
pander(anova(Age1Length_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |  588  | 105297  |     0     |
# |     **OA**      |   1   |   8   |  58.24  | 6.121e-05 |
# |  **Salinity**   |   1   |   8   |  105.2  | 7.024e-06 |
# | **OA:Salinity** |   1   |   8   |  1.258  |  0.2945   |
leveneTest(residuals(Age1Length_lme_mod_hightemp) ~Age1_raw_length_hightemp$OA*Age1_raw_length_hightemp$Salinity) # 0.4058 PASS
Age8Length_lme_mod <- lme(length_um~OA*Salinity*Temp,random=~1|random_fact,data=Age8_raw_length)
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
#data
Age8_raw_length_hightemp <- Age8_raw_length %>% dplyr::filter(!Temp %in% 'Low')
# run model ( LME model)
Age8Length_lme_mod_hightemp <- lme(length_um~OA*Salinity,random=~1|random_fact,data=Age8_raw_length_hightemp) # notice temp is removed...
pander(anova(Age8Length_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | numDF | denDF | F-value | p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:--------:|
# | **(Intercept)** |   1   |  531  |  1176   |    0     |
# |     **OA**      |   1   |   7   |  19.48  | 0.003104 | *
# |  **Salinity**   |   1   |   7   |  17.82  | 0.00393  | *
# | **OA:Salinity** |   1   |   7   |  3.686  | 0.09635  | (marginal)
leveneTest(residuals(Age8Length_lme_mod_hightemp) ~Age8_raw_length_hightemp$OA*Age8_raw_length_hightemp$Salinity) # 6.08e-12 *** no pass
qqnorm(resid(Age8Length_lme_mod_hightemp)) # check for normality of residuals
# run lm model
Age8Length_lm_mod_hightemp <- lm((length_um)~OA*Salinity,data=Age8_raw_length_hightemp) # notice temp is removed...
pander(anova(Age8Length_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:---------------:|:---:|:------:|:-------:|:-------:|:---------:|
# |     **OA**      |  1  | 113332 | 113332  |  277.2  | 1.649e-50 |
# |  **Salinity**   |  1  | 101921 | 101921  |  249.3  | 2.008e-46 |
# | **OA:Salinity** |  1  | 20519  |  20519  |  50.19  | 4.392e-12 |
# |  **Residuals**  | 538 | 219948 |  408.8  |   NA    |    NA     |
shapiro.test(residuals(Age8Length_lm_mod_hightemp)) #2.015e-11
# |     &nbsp;      | numDF | denDF | F-value | p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:--------:|
# | **(Intercept)** |   1   |  531  |  1176   |    0     |
# |     **OA**      |   1   |   7   |  19.48  | 0.003104 | *
# |  **Salinity**   |   1   |   7   |  17.82  | 0.00393  | *
# | **OA:Salinity** |   1   |   7   |  3.686  | 0.09635  | (marginal)
leveneTest(residuals(Age8Length_lme_mod_hightemp) ~Age8_raw_length_hightemp$OA*Age8_raw_length_hightemp$Salinity) # 6.08e-12 *** no pass
leveneTest(residuals(Age8Length_lm_mod_hightemp) ~Age8_raw_length_hightemp$OA*Age8_raw_length_hightemp$Salinity) # 1.054e-08 *** no pass
qqnorm(resid(Age8Length_lme_mod_hightemp)) # check for normality of residuals
# run model ( LME model)
Age8Length_lme_mod_hightemp <- lme(length_um~OA*Salinity,random=~1|random_fact,data=Age8_raw_length_hightemp) # notice temp is removed...
pander(anova(Age8Length_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
Age8Length_lme_mod <- lme(length_um~OA*Salinity*Temp,random=~1|random_fact,data=Age8_raw_length)
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   | 1050  |  2433   |     0     |
# |        **OA**        |   1   |  15   |  17.5   | 0.0008002 |
# |     **Salinity**     |   1   |  15   |  16.61  | 0.0009943 |
# |       **Temp**       |   1   |  15   |  5.035  |  0.04035  |
# |   **OA:Salinity**    |   1   |  15   | 0.9695  |  0.3404   |
# |     **OA:Temp**      |   1   |  15   |  7.119  |  0.01754  |
# |  **Salinity:Temp**   |   1   |  15   |  4.766  |  0.04532  |
# | **OA:Salinity:Temp** |   1   |  15   |  4.322  |  0.05518  |
leveneTest(residuals(Age8Length_lme_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
#  run model (lm)
Age8Length_lm_mod <- lm(length_um~OA*Salinity*Temp,data=Age8_raw_length)
pander(anova(Age8Length_lm_mod), style='rmarkdown') # anova table of lmr
# |        &nbsp;        |  Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:--------------------:|:----:|:------:|:-------:|:-------:|:---------:|
# |        **OA**        |  1   | 87009  |  87009  |  269.5  | 3.636e-54 |
# |     **Salinity**     |  1   | 76531  |  76531  |  237.1  | 1.894e-48 |
# |       **Temp**       |  1   | 25675  |  25675  |  79.53  | 2.022e-18 |
# |   **OA:Salinity**    |  1   |  3917  |  3917   |  12.13  | 0.0005157 |
# |     **OA:Temp**      |  1   | 37837  |  37837  |  117.2  | 5.505e-26 |
# |  **Salinity:Temp**   |  1   | 27137  |  27137  |  84.06  | 2.408e-19 |
# | **OA:Salinity:Temp** |  1   | 21019  |  21019  |  65.11  | 1.898e-15 |
# |    **Residuals**     | 1065 | 343803 |  322.8  |   NA    |    NA     |
shapiro.test(residuals(Age8Length_lm_mod)) # 1.397e-14
pander(anova(Age8Length_lme_mod), style='rmarkdown') # anova table of lmer
pander(anova(Age8Length_lm_mod), style='rmarkdown') # anova table of lmr
# |        &nbsp;        |  Df  | Sum Sq | Mean Sq | F value |  Pr(>F)   |
# |:--------------------:|:----:|:------:|:-------:|:-------:|:---------:|
# |        **OA**        |  1   | 87009  |  87009  |  269.5  | 3.636e-54 |
# |     **Salinity**     |  1   | 76531  |  76531  |  237.1  | 1.894e-48 |
# |       **Temp**       |  1   | 25675  |  25675  |  79.53  | 2.022e-18 |
# |   **OA:Salinity**    |  1   |  3917  |  3917   |  12.13  | 0.0005157 |
# |     **OA:Temp**      |  1   | 37837  |  37837  |  117.2  | 5.505e-26 |
# |  **Salinity:Temp**   |  1   | 27137  |  27137  |  84.06  | 2.408e-19 |
# | **OA:Salinity:Temp** |  1   | 21019  |  21019  |  65.11  | 1.898e-15 |
# |    **Residuals**     | 1065 | 343803 |  322.8  |   NA    |    NA     |
shapiro.test(residuals(Age8Length_lm_mod)) # 1.397e-14
leveneTest(residuals(Age8Length_lm_mod) ~ Age8_raw_length$Temp*Age8_raw_length$OA*Age8_raw_length$Salinity) # < 2.2e-16 *** - did not pass
age_1<- Av_length.survival_dat %>%
filter(Day=="1")
Age1_Survival_lme_mod <- lme(Survival~OA*Salinity*Temp,random=~1|random_fact,data=age_1)
pander(anova(Age1_Survival_lme_mod), style='rmarkdown') # anova table of lmer
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   |  16   |  1835   |     0     |
# |        **OA**        |   1   |  16   |  10.28  | 0.005513  | *
# |     **Salinity**     |   1   |  16   |  1.647  |  0.2176   |
# |       **Temp**       |   1   |  16   |  22.72  | 0.0002102 | *
# |   **OA:Salinity**    |   1   |  16   |  7.528  |  0.01442  | *
# |     **OA:Temp**      |   1   |  16   |  2.487  |  0.1344   |
# |  **Salinity:Temp**   |   1   |  16   |  2.07   |  0.1695   |
# | **OA:Salinity:Temp** |   1   |  16   |  3.096  |  0.09758  |
leveneTest(residuals(Age1_Survival_lme_mod) ~ age_1$Temp*age_1$OA*age_1$Salinity) # 0.8279- pass
pander(anova(Age1_Survival_lme_mod), style='rmarkdown') # anova table of lmer
Age1_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_1)
# |        &nbsp;        | Df |  Sum Sq  | Mean Sq  | F value |  Pr(>F)   |
# |:--------------------:|:--:|:--------:|:--------:|:-------:|:---------:|
# |        **OA**        | 1  | 0.02837  | 0.02837  |  10.28  | 0.005513  |
# |     **Salinity**     | 1  | 0.004548 | 0.004548 |  1.647  |  0.2176   |
# |       **Temp**       | 1  | 0.06273  | 0.06273  |  22.72  | 0.0002102 |
# |   **OA:Salinity**    | 1  | 0.02079  | 0.02079  |  7.528  |  0.01442  |
# |     **OA:Temp**      | 1  | 0.006866 | 0.006866 |  2.487  |  0.1344   |
# |  **Salinity:Temp**   | 1  | 0.005716 | 0.005716 |  2.07   |  0.1695   |
# | **OA:Salinity:Temp** | 1  | 0.008549 | 0.008549 |  3.096  |  0.09758  |
# |    **Residuals**     | 16 | 0.04418  | 0.002761 |   NA    |    NA     |
shapiro.test(residuals(Age1_Survival_lm_mod)) #0.156
leveneTest(residuals(Age1_Survival_lm_mod) ~ age_1$Temp*age_1$OA*age_1$Salinity) # 0.8279- pass
pander(anova(Age1_Survival_lm_mod), style='rmarkdown') # anova table of lmr
pander(anova(Age1_Survival_lm_mod), style='rmarkdown') # anova table of lmr
age_1_hightemp <- Av_length.survival_dat %>%
filter(Day=="1") %>%
dplyr::filter(Temp %in% 'High')
Age1_Survival_lme_mod_hightemp <- lme(Survival~OA*Salinity,random=~1|random_fact,data=age_1_hightemp)
pander(anova(Age1_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
pander(anova(Age1_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |   8   |  2296   | 3.977e-11 |
# |     **OA**      |   1   |   8   |  23.18  |  0.00133  | * main effect of OA
# |  **Salinity**   |   1   |   8   | 0.02447 |  0.8796   |
# | **OA:Salinity** |   1   |   8   | 0.9816  |  0.3508   |
leveneTest(residuals(Age1_Survival_lme_mod_hightemp) ~ age_1_hightemp$OA*age_1_hightemp$Salinity) # 0.5608- pass
# lm model
Age1_Survival_lm_mod_hightemp <- lm(Survival~OA*Salinity,data=age_1_hightemp)
pander(anova(Age1_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lm
# |     &nbsp;      | Df |  Sum Sq   |  Mean Sq  | F value | Pr(>F)  |
# |:---------------:|:--:|:---------:|:---------:|:-------:|:-------:|
# |     **OA**      | 1  |  0.03158  |  0.03158  |  23.18  | 0.00133 | * main effect of OA
# |  **Salinity**   | 1  | 3.333e-05 | 3.333e-05 | 0.02447 | 0.8796  |
# | **OA:Salinity** | 1  | 0.001337  | 0.001337  | 0.9816  | 0.3508  |
# |  **Residuals**  | 8  |  0.0109   | 0.001362  |   NA    |   NA    |
shapiro.test(residuals(Age1_Survival_lm_mod_hightemp)) # 0.7963
age_8<- Av_length.survival_dat%>%
filter(Day=="8") %>%
arrange(Survival) %>%
mutate(Survival = ifelse(Survival == last(Survival), 0.75, Survival)) # ID #12 was 0.86 -  whereas survival on day 4 was 0.75 - this is an artifact of increased numbers? I changed to 0.75 to reflect no losses between days 4 and 8
Age8_Survival_lme_mod <- lme(Survival~OA*Salinity*Temp,random=~1|random_fact,data=age_8)
pander(anova(Age8_Survival_lme_mod), style='rmarkdown') # anova table of lm
# |        &nbsp;        | numDF | denDF | F-value |  p-value  |
# |:--------------------:|:-----:|:-----:|:-------:|:---------:|
# |   **(Intercept)**    |   1   |  16   |  46.08  | 4.355e-06 |
# |        **OA**        |   1   |  16   | 0.3291  |  0.5742   |
# |     **Salinity**     |   1   |  16   |  14.26  | 0.001652  | *
# |       **Temp**       |   1   |  16   |  0.028  |  0.8692   |
# |   **OA:Salinity**    |   1   |  16   |  0.112  |  0.7422   |
# |     **OA:Temp**      |   1   |  16   | 0.06913 |   0.796   |
# |  **Salinity:Temp**   |   1   |  16   | 0.1651  |  0.6899   |
# | **OA:Salinity:Temp** |   1   |  16   | 0.4805  |  0.4981   |
leveneTest(residuals(Age8_Survival_lme_mod) ~ age_8$Temp*age_8$OA*age_8$Salinity) # 0.41 pass
pander(anova(Age8_Survival_lme_mod), style='rmarkdown') # anova table of lm
pander(anova(Age1_Survival_lme_mod), style='rmarkdown') # anova table of lmer
pander(anova(Age1Length_lme_mod), style='rmarkdown') # anova table of lmer
# run mod (lm model)
Age8_Survival_lm_mod <- lm(Survival~OA*Salinity*Temp,data=age_8)
pander(anova(Age8_Survival_lm_mod), style='rmarkdown') # anova table of lm
shapiro.test(residuals(Age8_Survival_lm_mod)) # 0.1661 pass
leveneTest(residuals(Age8_Survival_lm_mod) ~ age_8$Temp*age_8$OA*age_8$Salinity) # 0.1911 pass
shapiro.test(residuals(Age8_Survival_lm_mod)) # 0.1661 pass
leveneTest(residuals(Age8_Survival_lm_mod) ~ age_8$Temp*age_8$OA*age_8$Salinity) # 0.1911 pass
pander(anova(Age8_Survival_lm_mod), style='rmarkdown') # anova table of lm
age_8_hightemp <- Av_length.survival_dat %>%
filter(Day=="8") %>%
dplyr::filter(Temp %in% 'High')
Age8_Survival_lme_mod_hightemp <- lme(Survival~OA*Salinity,random=~1|random_fact,data=age_8_hightemp)
pander(anova(Age8_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |   6   |  46.03  | 0.0005015 |
# |     **OA**      |   1   |   6   | 0.3174  |  0.5936   |
# |  **Salinity**   |   1   |   6   |  15.52  |  0.00763  | # main effect of salinity
# | **OA:Salinity** |   1   |   6   | 0.1175  |  0.7434   |
leveneTest(residuals(Age8_Survival_lme_mod_hightemp) ~ age_8_hightemp$OA*age_8_hightemp$Salinity) # 0.6261- pass
# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |   6   |  46.03  | 0.0005015 |
# |     **OA**      |   1   |   6   | 0.3174  |  0.5936   |
# |  **Salinity**   |   1   |   6   |  15.52  |  0.00763  | # main effect of salinity
# | **OA:Salinity** |   1   |   6   | 0.1175  |  0.7434   |
leveneTest(residuals(Age8_Survival_lme_mod_hightemp) ~ age_8_hightemp$OA*age_8_hightemp$Salinity) # 0.6261- pass
# run modle (lm)
Age8_Survival_lm_mod_hightemp <- lm(Survival~OA*Salinity,data=age_8_hightemp)
pander(anova(Age8_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | Df |  Sum Sq  | Mean Sq  | F value | Pr(>F)  |
# |:---------------:|:--:|:--------:|:--------:|:-------:|:-------:|
# |     **OA**      | 1  | 0.00384  | 0.00384  | 0.3174  | 0.5936  |
# |  **Salinity**   | 1  |  0.1878  |  0.1878  |  15.52  | 0.00763 | # main effect of salinity
# | **OA:Salinity** | 1  | 0.001422 | 0.001422 | 0.1175  | 0.7434  |
# |  **Residuals**  | 6  |  0.0726  |  0.0121  |   NA    |   NA    |
shapiro.test(residuals(Age8_Survival_lm_mod_hightemp)) # 0.7963
# run modle (lm)
Age8_Survival_lm_mod_hightemp <- lm(Survival~OA*Salinity,data=age_8_hightemp)
pander(anova(Age8_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | Df |  Sum Sq  | Mean Sq  | F value | Pr(>F)  |
# |:---------------:|:--:|:--------:|:--------:|:-------:|:-------:|
# |     **OA**      | 1  | 0.00384  | 0.00384  | 0.3174  | 0.5936  |
# |  **Salinity**   | 1  |  0.1878  |  0.1878  |  15.52  | 0.00763 | # main effect of salinity
# | **OA:Salinity** | 1  | 0.001422 | 0.001422 | 0.1175  | 0.7434  |
# |  **Residuals**  | 6  |  0.0726  |  0.0121  |   NA    |   NA    |
shapiro.test(residuals(Age8_Survival_lm_mod_hightemp)) # 0.7963
pander(anova(Age8_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
age_8_hightemp <- Av_length.survival_dat %>%
filter(Day=="8") %>%
dplyr::filter(Temp %in% 'High')
Age8_Survival_lme_mod_hightemp <- lme(Survival~OA*Salinity,random=~1|random_fact,data=age_8_hightemp)
pander(anova(Age8_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
age_8_hightemp
age_8_hightemp <- Av_length.survival_dat %>%
filter(Day=="8") %>%
dplyr::filter(Temp %in% 'High')
Age8_Survival_lme_mod_hightemp <- lme(Survival~OA*Salinity,random=~1|random_fact,data=age_8_hightemp)
pander(anova(Age8_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |   6   |  46.03  | 0.0005015 |
# |     **OA**      |   1   |   6   | 0.3174  |  0.5936   |
# |  **Salinity**   |   1   |   6   |  15.52  |  0.00763  | # main effect of salinity
# | **OA:Salinity** |   1   |   6   | 0.1175  |  0.7434   |
leveneTest(residuals(Age8_Survival_lme_mod_hightemp) ~ age_8_hightemp$OA*age_8_hightemp$Salinity) # 0.6261- pass
boxplot(residuals(Age8_Survival_lm_mod_hightemp) ~ age_8_hightemp$OA*age_8_hightemp$Salinity) # visual of residuals grouped
pander(anova(Age8_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
# run modle (lm)
Age8_Survival_lm_mod_hightemp <- lm(Survival~OA*Salinity,data=age_8_hightemp)
pander(anova(Age8_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
# |     &nbsp;      | Df |  Sum Sq  | Mean Sq  | F value | Pr(>F)  |
# |:---------------:|:--:|:--------:|:--------:|:-------:|:-------:|
# |     **OA**      | 1  | 0.00384  | 0.00384  | 0.3174  | 0.5936  |
# |  **Salinity**   | 1  |  0.1878  |  0.1878  |  15.52  | 0.00763 | # main effect of salinity
# | **OA:Salinity** | 1  | 0.001422 | 0.001422 | 0.1175  | 0.7434  |
# |  **Residuals**  | 6  |  0.0726  |  0.0121  |   NA    |   NA    |
shapiro.test(residuals(Age8_Survival_lm_mod_hightemp)) # 0.8541
leveneTest(residuals(Age8_Survival_lm_mod_hightemp) ~ age_8_hightemp$OA*age_8_hightemp$Salinity) # 0.5608- pass
pander(anova(Age8_Survival_lm_mod_hightemp), style='rmarkdown') # anova table of lmer
pander(anova(Age8_Survival_lme_mod_hightemp), style='rmarkdown') # anova table of lmer
random_fact
Age1_raw_length
Age1Length_lme_mod <- lme(length_um~OA*Temp*Salinity,random=~1|random_fact,data=Age1_raw_length)
pander(anova(Age1Length_lme_mod), style='rmarkdown') # anova table of lmer
# run model (lm mod)
Age1Length_lm_mod <- lm(length_um~OA*Temp*Salinity,data=Age1_raw_length)
pander(anova(Age1Length_lm_mod), style='rmarkdown') # anova table of lmer
# Purpose: Oyster project 2021 - Respiration rate data
# analysis of respiration rate data
# Written by: Sam J Gurr (last edit 9/14/2021)
# LOAD PACKAGES :::::::::::::::::::::::::::::::::::::::::::::::::::::::
library(dplyr)
library(ggplot2)
library(reshape2)
library(lme4)
library(lmerTest)
library(performance) # check check_model QC
library(see)
library(patchwork)
library(forcats)
library(lawstat)
library(car)
library(pander)
# SET WORKING DIRECTORY :::::::::::::::::::::::::::::::::::::::::::::::
setwd("C:/Users/samjg/Documents/Github_repositories/Cvirginica_multistressor/RAnalysis") # personal computer
# setwd("C:/Users/samuel.gurr/Documents/Github_repositories/Cvriginica_multistressor/RAnalysis") # Work computer
# LOAD DATA :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
exp_metadata <- read.csv(file="Data/ExperimentMetadata.csv", header=T) # treatment assignments to 'Chamber_Tank'
aragonite_dat<- read.csv(file='Output/Water_Chem/Chem.Table_sep.csv', header = T) %>%
dplyr::select(c('meanAragonite','Temp_OA_Sal')) %>%
dplyr::rename(TempCarbSal = Temp_OA_Sal)
aragonite_dat$TempCarbSal <-  gsub("_", "", aragonite_dat$TempCarbSal)
counts_resp  <- read.csv(file="Data/Counts_resp.csv", header=T) # reference for the respirometry data - contains the 'Chamber_Tank' for each sensor channel (whether an animal or a blank)
resp.ref     <- read.csv(file="Data/Respiration/Reference_master.csv", header=T) %>%
dplyr::filter(!Filename %in% c('1_3_19_21_raw.txt', 'may_7_2021_low_temo_10-12_ans_13-15_high_sal_raw_b.txt')) # reference for the respirometry data - contains the 'Chamber_Tank' for each sensor channel (whether an animal or a blank)
resp.data    <- read.csv(file="Output/Respiration/Cumulative_resp_alpha0.4.csv", header=T) %>%
dplyr::filter(!Filename %in% c('1_3_19_21_raw.txt', 'may_7_2021_low_temo_10-12_ans_13-15_high_sal_raw_b.txt'))# read the calculated raw rates from 'resp_LoLin' script - contains the calculated rate (not normalized for blanks) for each sensor-channel
# merge the exp_metadata with the resp.data
resp.ref_merged                 <- merge(exp_metadata, resp.ref, by = 'Chamber_tank', all=TRUE) # all TRUE allows us to keep the blanks
resp.data_merged                <- merge(resp.data, resp.ref_merged, by = c('Date', 'Channel','Notes','Filename')) %>%
dplyr::mutate(TempCarbSal = case_when( !is.na(Temp) ~ (as.character(paste(Temp, pCO2, Salinity, sep =''))) )) %>%
dplyr::mutate(Aragonite_saturation = case_when( (TempCarbSal == "HHH") ~ 0.7,
(TempCarbSal == 'HHL') ~ 0.3,
(TempCarbSal == 'HLH') ~ 1.6,
(TempCarbSal == 'HLL') ~ 0.6,
(TempCarbSal == 'LLL') ~ 0.5,
(TempCarbSal == 'LLH') ~ 1.5,
(TempCarbSal == 'LHL') ~ 0.2,
(TempCarbSal == 'LHH') ~ 0.6))
dates.runs <- resp.data_merged %>%  # call table
dplyr::distinct(Date, Notes) # call all unique values for date run and sw condition
dates.runs <- na.omit(dates.runs)
# call dataframe and build table to rbind in for loop
blanks_total <- data.frame() # start dataframe
blanks.table <- data.frame(matrix(nrow = 1,ncol = 5)) # make a table template
colnames(blanks.table)<-c('Date', 'Notes', 'BLANK.mean.Lpc', 'BLANK.mean.Leq' , 'BLANK.mean.Lz') # names for comuns in the for loop
# for loop. objective = obtian a mean value for all blanks specific to date, run #, seawater treatment
for(i in 1:nrow(dates.runs)) {
data <- resp.data_merged %>%
dplyr::select(Date, Chamber_tank, Notes, Lpc,  Leq, Lz) %>%
dplyr::filter(!is.na(Lpc)) %>% # ommits empty resp channels (if any)
dplyr::filter(Notes == dates.runs[i,2])
blanks <- data %>%
dplyr::filter(Chamber_tank == "blank") %>%
dplyr::mutate(Lpc = case_when(Lpc >= 0 ~ 0, TRUE ~ Lpc)) %>%
dplyr::summarise(mean_Lpc = mean(abs(Lpc)),
mean_Leq = mean(abs(Leq)),
mean_Lz = mean(abs(Lz)))
blanks.table$Date           <- dates.runs[i,1] # all files have date in the form of yyyymmdd at the start of each csv name
#blanks.table$RUN <- dates.runs[i,2] # assign the run to the number in the title for the trials completed that day
blanks.table$Notes      <- dates.runs[i,2]
blanks.table$BLANK.mean.Lpc <- blanks[1,1]
blanks.table$BLANK.mean.Leq <- blanks[1,2]
blanks.table$BLANK.mean.Lz  <- blanks[1,3]
# blanks.table$alpha <- data[1,9] # set at start of script - reresents the proportion of data for final estimate of slopes (Lpc, Leq, Lz)
df <- data.frame(blanks.table) # name dataframe for this singl e row
blanks_total <- rbind(blanks_total,df) #bind to a cumulative list dataframe
# print(blanks_total) # print to monitor progress
}
head(blanks_total) # view blanks table
Resp.blanks.merge <- merge(resp.data_merged, blanks_total, by=c("Date", "Notes")) %>% # NOTE: this repeats for every distinct length value
dplyr::filter(!Chamber_tank =='blank') %>%
dplyr::filter(!Lpc > 0) %>% # onlynegative raw lpc values from LoLinR represent oxygen depletion - positive values are errors
dplyr::mutate(resp_norm = abs(Lpc) - BLANK.mean.Lpc)   #  Lpc is still raw data (take abs) then resp - blank - all Lpc are <0 before the abs value taken
Resp.blanks.merge_OM <- Resp.blanks.merge %>% dplyr::filter(resp_norm > 0)  # omits respiration rate values LESS than the blank (resp_norm < 0)
Resp.outliers        <- Resp.blanks.merge %>% dplyr::filter(resp_norm < 0)  # 10 total samples lower than the blank
print(c("number of blank resp > sample resp =",nrow(Resp.outliers)))
count_check_all <- Resp.blanks.merge_OM %>% dplyr::group_by(Date,TempCarbSal) %>% dplyr::summarise(n = n())
knitr::kable(count_check_all)
count_check_true_rates <- Resp.blanks.merge_OM %>% dplyr::filter(!Lpc > 0) %>% dplyr::group_by(Date,TempCarbSal) %>% dplyr::summarise(n = n()) # omit those wit positive values - no oxygen consumption recorded
knitr::kable(count_check_true_rates)
### no HLL after filtered of poor data
vial.vol <- 0.08 # milliliters (ml)
Resp.Master <- merge(Resp.blanks.merge_OM[,c(1,3,5,9:14,18)], counts_resp[,c(1,6:7)], by = c('Date','Chamber_tank'))
Resp.Master$resp_ng_L_indiv_hr <- (
( ( (abs(Resp.Master$resp_norm)*1000000) * # call absolute value of resp in mg per minute - convert to ng min-1
(vial.vol/1000) ) / # correct ng minute-1 to ng liter-1 by multiplying by the resp vial in liters
Resp.Master$Counts ) * # normalize by individual or larvae count - as to ng L-1 individual-1
(60)) # correct for the time; final value is ng Liter-1 individual-1 hour-1
# mean sd rates
# mean(Resp.Master$resp_ng_L_indiv_hr) # mean = 0.4994656
# sd(Resp.Master$resp_ng_L_indiv_hr) # sd= 0.8197345
Resp.Master[,c(1:3,12)]
# a.
Resp_age1 <- Resp.Master %>%
dplyr::filter(Date %in% '4/30/2021')  %>%
dplyr::mutate(Treatment = as.character(paste('Temp.', Temp, '_OA.', pCO2, '_Sal.',Salinity, sep = ''))) %>%
dplyr::mutate(pCO2_Salinity = as.character(substr(TempCarbSal, 2, 3))) %>%
dplyr::mutate(Temp = (fct_relevel(Temp, c('L','H'))))
# b.
Resp_age1 <- merge(Resp_age1, aragonite_dat, by = 'TempCarbSal') # merge with the mean aragonite saturation state
## Plot geeom boxlot with jitter
Resp_Age1_Boxplot <- ggplot(data=Resp_age1,
aes(x=as.factor(Aragonite_saturation),
#aes(x=meanAragonite,
y=resp_ng_L_indiv_hr,
fill=pCO2_Salinity)) +
geom_boxplot()+
geom_jitter(width = 0.1)+
scale_fill_manual(values=c("skyblue2", "darkorange3","royalblue3", "orange2"))+
theme_bw() +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
labs(title = "Age =24 hours; Respiration rates",
y = expression(Respiration~rate~"("~ng~L^{-1}~O[2]%.%indiv^{-1}%.% hr^{-1}~")"),
x = "Aragonite saturation") +
theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
theme(axis.text=element_text(size=12)) +
facet_wrap(~Temp )
Resp_Age1_Boxplot
Resp_Age1_Boxplot
# c.
LMmod.age1   <- aov(lm( resp_ng_L_indiv_hr~Temp*pCO2*Salinity,data=Resp_age1))
pander(anova(LMmod.age1), style='rmarkdown') # anova table of lme
# |      &nbsp;       | Df |  Sum Sq   |  Mean Sq  | F value | Pr(>F) |
# |:-----------------:|:--:|:---------:|:---------:|:-------:|:------:|
# |     **Temp**      | 1  | 0.008991  | 0.008991  |  2.921  | 0.1112 |
# |     **pCO2**      | 1  | 0.0003919 | 0.0003919 | 0.1273  | 0.7269 |
# |   **Salinity**    | 1  | 0.002814  | 0.002814  | 0.9143  | 0.3564 |
# |   **Temp:pCO2**   | 1  | 0.007718  | 0.007718  |  2.508  | 0.1373 |
# | **Temp:Salinity** | 1  | 0.001345  | 0.001345  | 0.4372  |  0.52  |
# | **pCO2:Salinity** | 1  | 0.001578  | 0.001578  | 0.5126  | 0.4867 |
# |   **Residuals**   | 13 |  0.04001  | 0.003078  |   NA    |   NA   |
shapiro.test(residuals(LMmod.age1)) # 0.05381
leveneTest(LMmod.age1) # 0.3871 good
pander(anova(LMmod.age1), style='rmarkdown') # anova table of lme
# c.
LMmod.age1   <- aov(lm( resp_ng_L_indiv_hr~Temp*pCO2*Salinity,data=Resp_age1))
print('LM model  == aov( lm ( resp_ng_L_indiv_hr ~ Temp * pCO2 * Salinity, data = Resp_APRIL ) )')
pander(anova(LMmod.age1), style='rmarkdown') # anova table of lme
Age1Length_lme_mod <- lme(length_um~OA*Temp*Salinity,random=~1|random_fact,data=Age1_raw_length)
pander(anova(Age1Length_lme_mod), style='rmarkdown') # anova table of lmer
ggplot(Age1_raw_length, aes(x = length_um)) +
geom_histogram(binwidth = 1, fill = "white", colour = "black")
