---
title: "Regressions"
author: "Katie McFarland"
date: "7/23/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Load libraries

```{r, include=FALSE}
library("ggplot2")
library("tidyverse")
#library("car")
#library("nlme")
library(multcompView)
library("agricolae")
library(dplyr)
```

## Set Path
```{r}
#Set Path

setwd("C:/Users/katherine.mcfarland/Documents/Acidification/Oysters/Stats")


```

# Start with Endpoint Analysis

### Load Data
```{r}
larvaldata<-read.csv("larvaldata.csv", header = T)


#to look at headers
head(larvaldata)

#Sturcture of the data - to check that variables are properly assigned to facotr or variable
str(larvaldata)

# We need to make Aragonite a character rather than numberic so that it will plot nicely on the x-axis
larvaldata[,12] <-as.character(larvaldata[,12])
str(larvaldata)
```


#Box Plot
Color codes for ggPlot2:  http://sape.inf.usi.ch/quick-reference/ggplot2/colour
This chunk has code for changing the axis titles as well as the size of the axis titles and labels so that you can make them larger and easier to read on the small screen during your presentation. 


```{r, echo=FALSE}
age_1<- larvaldata%>%
  filter(Day=="1")

##Here Low Salinity treatments are in Blue
ggplot(data=age_1, aes(x=AR, y=Average.Length, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "darkorange3","royalblue3", "royalblue3","orange2", "orange2","skyblue2", "skyblue2"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age =24 hours", x ="Aragonite Saturation State", y = "Shell Length (μm)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  
  
```

```{r, echo=FALSE}
age_8<- larvaldata%>%
  filter(Day=="8")

##Here Low Salinity treatments are in Blue
ggplot(data=age_8, aes(x=AR, y=Average.Length, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "darkorange3","royalblue3", "royalblue3","orange2", "orange2","skyblue2", "skyblue2"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age = 8 days", x ="Aragonite Saturation State", y = "Shell Length (μm)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  

```



### Linear regression of average length by Aragonite saturation 
We want to look at the adjusted R squared associated F statistics at the bottom of the results
```{r}
#Linear Regression
lmLength <- lm(age_1$Average.Length ~ age_1$AR)
summary(lmLength)

lmLength <- lm(age_8$Average.Length ~ age_8$AR)
summary(lmLength)
```
```{r}
library(nlme)

age_1<- larvaldata%>%
  filter(Day=="1")

fit <-lme(Average.Length ~  Salinity*Temp*OA, random =~1|Replicate, data =age_1)
anova(fit)

age_8<- larvaldata%>%
  filter(Day=="8")

fit <-lme(Average.Length ~  Salinity*Temp*OA, random =~1|Replicate, data =age_8)
anova(fit)
```





# Survival

```{r, echo=FALSE}
age_1<- larvaldata%>%
  filter(Day=="1")

##Here Low Salinity treatments are in Blue
ggplot(data=age_1, aes(x=AR, y=Survival, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "darkorange3","royalblue3", "royalblue3","orange2", "orange2","skyblue2", "skyblue2"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age =24 hours", x ="Aragonite Saturation State", y = "Survival (%)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  
  
```

```{r, echo=FALSE}
age_1<- larvaldata%>%
  filter(Day=="1", Temp == "High")

##Here Low Salinity treatments are in Blue
ggplot(data=age_1, aes(x=AR, y=Survival, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "orange2","royalblue3", "lightblue3"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age = 24 hours", x ="Aragonite Saturation State", y = "Survival (%)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  

```

```{r, echo=FALSE}
age_8<- larvaldata%>%
  filter(Day=="8")

##Here Low Salinity treatments are in Blue
ggplot(data=age_8, aes(x=AR, y=Survival, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "darkorange3","royalblue3", "royalblue3","orange2", "orange2","skyblue2", "skyblue2"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age = 8 days", x ="Aragonite Saturation State", y = "Survival (%)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  

```

```{r, echo=FALSE}
age_8<- larvaldata%>%
  filter(Day=="8", Temp == "High")

##Here Low Salinity treatments are in Blue
ggplot(data=age_8, aes(x=AR, y=Survival, fill=Treatment)) +
  geom_boxplot()+scale_fill_manual(values=c("darkorange3", "royalblue3","orange2", "skyblue2"))+
  theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(title="Age = 8 days", x ="Aragonite Saturation State", y = "Survival (%)")+ theme(axis.title.y = element_text(size = rel(1.3), angle =90), axis.title.x = element_text(size = rel(1.3), angle = 0))+
  theme(axis.text=element_text(size=12))
  

```

### Linear regression of average length by Aragonite saturation 
We want to look at the adjusted R squared associated F statistics at the bottom of the results
```{r}
#Linear Regression
lmSurvival <- lm(age_1$Survival ~ age_1$AR)
summary(lmSurvival)

lmSurvival <- lm(age_8$Survival ~ age_8$AR)
summary(lmSurvival)
```

```{r}
library(nlme)

age_1<- larvaldata%>%
  filter(Day=="1")

fit <-lme(Survival.Tans ~  Salinity*Temp*OA, random =~1|Replicate, data =age_1)
anova(fit)

age_8<- larvaldata%>%
  filter(Day=="8")

fit <-lme(Survival.Tans ~  Salinity*Temp*OA, random =~1|Replicate, data =age_8)
anova(fit)

fit2 <-lme(Survival.Tans ~  Treatment, random =~1|Replicate, data =age_8)
anova(fit2)
#tukey_hsd(fit2)
```


### Linear regression of average length by Aragonite saturation 
We want to look at the adjusted R squared associated F statistics at the bottom of the results
```{r}
#Linear Regression
lmSurvival <- lm(age_1$Survival ~ age_1$AR)
summary(lmSurvival)

lmSurvival <- lm(age_8$Survival ~ age_8$AR)
summary(lmSurvival)
```


#print session info so that you know what versions were used for this analysis
```{r}
sessionInfo()
```

